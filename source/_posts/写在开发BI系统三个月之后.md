---
title: 写在开发BI系统三个月之后
id: after-three-months-of-developing-bi
date: 2019-05-19 20:29:55
updated: 2019-05-19 20:29:55
categories:
  - 赋予岁月以灵魂
tags:
---
我也记不清大概是什么时候接手的BI系统的开发，但是我觉得至少应该有三个月了。

在这三个月里，除了熟悉DataWorks的使用，大部分时间可能都花费在了反复推敲指标的定义，以及跟各个系统的开发了解业务流程或者数据特征上。

从中我学到的最重要的一件事，就是一定不要程序写完就不管了，一定要定期去查看自己的数据，或者写一些验证SQL去跑一遍。

我每天都能看到各个系统，因为某些原因，产生了不标准的，甚至错误的数据。

<!-- more -->

有些是产品设计上存在问题，程序没有拦截住；有些是程序存在Bug，测试时没有测出来；有些是表里新加的字段，但是没有给旧数据补上正确的值；有些是功能开发人员，和旧数据迁移人员是两个人，对部分数据属性的理解存在偏差；有些是迁移数据时，给某些属性附上正确的值需要从别的系统拿数据，太麻烦，直接就给个统一值，反正不影响系统运行；等等等等。

其中有些系统，因为流程比较靠前，直接影响到下游系统的数据。有错大家一起出，那上游系统Bug修复了，数据改好了，下游要不要一起改呢？或者上游系统Bug修复了，数据不改了，下游要不要也就那样让数据烂在哪里呢？会不会影响系统运行呢？

然后到了BI这边，因为上游数据存在问题，开发又不能改，或者不愿意改，为了让统计出来的数据尽量准确，我会不断去修改统计流程，去尽量修正这些数据错误。比如某个订单，可能订单库里冗余了商品类型，但是其中10%的数据商品类型是错误的，那这个字段我只能去商品库拿，这个冗余字段对我来说就完全不能使用。

尽管我尽量去兼容了，还是会每天发现新的数据错误，或者意料之外的数据。比如业务流程发生了变动，或者开辟了新的业务线，本来状态有6个值，现在改成了8个，那可能我根据状态去统计的一些指标就会出问题。还有一次，某个类型值可能是1或者2，我为了表示全部用到0，后来发现源数据库里发现了类型为0数据，我问是怎么回事，他说某些迁移数据因为不知道该给1还是给2，就给了个0，其实没有任何意义。但是因为人家业务方的开发是不管我这些的，也不知道哪些会影响到我，人家忙得开发时间都不够，哪有时间告诉我这些。等到我发现时，可能已经过了好几天了。

那怎么去及时发现这个问题呢？我能想到的，第一就是关注系统发布邮件，仔细看每个系统每次发布都有哪些改动。第二就是写验证SQL，我去验你的状态是不是只有6个，验你的商品类型是不是和商品库里的相符，验你的数据是不是都符合业务上应该呈现出来的规律或者满足约束。

而且这个不光我应该写，我觉得各个系统的开发也应该写，去验证自己的数据，尤其是开发时间紧张，业务逻辑复杂，又没写单元测试，测试总是来不及测完全就上线的这种情形。毕竟最后线上数据出了问题，谁来背锅，谁来解决，自己心里很清楚的吧？

至于那些各业务方对同一指标理解不一致啦，每个月重新定义一次指标定义啦，所有接口需要重写重测重采集啦，这种需求上的问题，光是想一下我都没有力气吐槽，只盼产品多多和业务方沟通。

或者打爆产品的狗头。
